language: python

python:
  - "2.7"
  - "3.3"

# Build inside docker containers instead of virtual machines. These are
# faster, start quicker and support caching.
sudo: false

# Setup (performed within virtualenv)
install:
  # Check that the source distribution can be used for installation -
  # without having *any* dependencies installed:
  - python setup.py sdist
  - pip install $(ls ./dist/*.tar.gz | sort -rV | head -n1)
  # Need to remove minrpc folder otherwise it will be imported, but we want
  # to check the version installed from the source distribution:
  - rm -r minrpc

  - pip install nose coverage coveralls

# Actual tests:
script:
  - coverage run --source=minrpc    test/test_rpc.py      -v

after_success:
  - base=`python -c 'import os,minrpc; print(os.path.dirname(minrpc.__file__))'`/..
  - mv .git .coverage $base
  - cd $base
  - coveralls
